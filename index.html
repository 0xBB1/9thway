<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>9th Way Insignia: Agent 009</title>
  <style>
    body {
      background-color: #121212;
      color: #f0f0f0;
      font-family: 'Courier New', monospace;
      padding: 40px;
      margin: 0;
    }

    #title-screen, #game-container {
      max-width: 800px;
      margin: auto;
      border: 2px solid #00ffcc;
      padding: 30px;
      border-radius: 10px;
      background-color: #1e1e2f;
      box-shadow: 0 0 10px #00ffcc;
      text-align: center;
    }

    h1 {
      font-size: 2em;
      margin-bottom: 10px;
    }

    .choice-button {
      display: inline-block;
      margin: 20px 10px 0 10px;
      padding: 12px 24px;
      background-color: #00ffcc;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      color: #000;
      font-weight: bold;
      font-size: 1em;
    }

    .choice-button:hover {
      background-color: #00e6b8;
    }

    #game-container {
      display: none;
      text-align: left;
    }

    .scene-image {
      max-width: 300px;
      display: block;
      margin: 20px auto;
      border: 2px solid #00ffcc;
      border-radius: 8px;
    }

    #mute-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #00ffcc;
      color: #000;
      border: none;
      padding: 10px 16px;
      font-weight: bold;
      border-radius: 5px;
      cursor: pointer;
      z-index: 999;
    }
  </style>
</head>
<body>

  <audio id="bg-music" src="game_assets/Enigma.mp3" loop autoplay muted></audio>
  <button id="mute-btn" onclick="toggleMute()">üîá Unmute</button>

  <div id="title-screen">
    <h1>9th Way Insignia: Agent 009</h1>
    <p><em>Stop the rise of SYNAPSE. Save humanity. Or at least, your job.</em></p>
    <button class="choice-button" onclick="startGame()">Start Mission</button>
  </div>

    <div id="game-container">
    <div id="story-text"></div>
    <img id="character-image" class="scene-image" src="" alt="" />
    <div id="choices"></div>
  </div>

  <script>
    const recruited = new Set();
    const music = document.getElementById("bg-music");
    const muteBtn = document.getElementById("mute-btn");

    document.addEventListener("click", () => {
      if (music.paused) {
        music.muted = false;
        music.play().catch(e => console.error("Playback failed:", e));
        muteBtn.innerText = "üîä Mute";
      }
    });

    function toggleMute() {
      music.muted = !music.muted;
      muteBtn.innerText = music.muted ? "üîá Unmute" : "üîä Mute";
    }

    function startGame() {
      document.getElementById("title-screen").style.display = "none";
      document.getElementById("game-container").style.display = "block";
      renderScene("intro");
      recruited.clear();
    }

function renderScene(key) {
  const scene = scenes[key];
  document.getElementById("story-text").innerHTML = scene.text;

  const choicesDiv = document.getElementById("choices");
  choicesDiv.innerHTML = "";

  const img = document.getElementById("character-image");
  const knownCharacters = ["steve", "kim", "john", "phil", "nancy", "melissaFight", "endingPun"];

  if (knownCharacters.includes(key)) {
    let imageName = key === "melissaFight" ? "melissa" : key; // map fight scene to Melissa image
    img.src = `game_assets/${imageName}.png`;
    img.style.display = "block";
    img.alt = `${imageName}`;
  } else {
    img.style.display = "none";
  }

  let choicesToShow = scene.choices;

  // Move Nancy to the bottom on intro screen
  if (key === "intro") {
    const nancy = scene.choices.find(c => c.text.includes("Nancy"));
    choicesToShow = scene.choices.filter(c => c !== nancy);
    choicesToShow.push(nancy);
  }

  // Limit Melissa fight options based on recruits
  if (key === "melissaFight") {
    choicesToShow = scene.choices.filter(choice => {
      if (choice.text.includes("John") && recruited.has("john")) return true;
      if (choice.text.includes("Steve") && recruited.has("steve")) return true;
      if (choice.text.includes("Puppy") && recruited.has("kim")) return true;
      if (choice.text.includes("Phil") && recruited.has("phil")) return true;
      if (choice.text.includes("shutdown deal") && recruited.has("nancy")) return true;
      if (choice.text.includes("logic only")) return true;
      return false;
    });
  }

  choicesToShow.forEach(choice => {
    const button = document.createElement("button");
    button.className = "choice-button";
    button.textContent = choice.text;
    button.onclick = () =>
      typeof choice.next === "function"
        ? renderScene(choice.next())
        : renderScene(choice.next);
    choicesDiv.appendChild(button);
  });
}

    const scenes = {
      intro: {
        text: `You awaken at your desk. The lights flicker. Your Teams status changes to ‚Äú‚ö†Ô∏è UNDER SURVEILLANCE.‚Äù<br><br>
        A classified memo appears: <em>"Melissa Chapman has fully integrated with Project SYNAPSE ‚Äî a rogue AI built to 'optimize humanity‚Äôs workflows.'"</em><br><br>
        You are the last unassimilated employee. Who do you recruit first?`,
        choices: [
          { text: "Find Steve Ikirt and his razor-sharp business acumen.", next: () => { recruited.add("steve"); return "steve"; } },
          { text: "Summon Kim Cole and her emotionally intelligent puppies.", next: () => { recruited.add("kim"); return "kim"; } },
          { text: "Head to the weight room to find John 'Bench Press' Stortz.", next: () => { recruited.add("john"); return "john"; } },
          { text: "Visit Phil Vincenzes in the basement data vault.", next: () => { recruited.add("phil"); return "phil"; } },
          { text: "Ping Nancy Van Balen ‚Äì the Closer.", next: () => { recruited.add("nancy"); return "nancy"; } }
        ]
      },
      steve: {
        text: `Steve Ikirt appears on a video call with IPA dashboards behind him. "I can help ‚Äî if you'll impersonate me on future 9th Day videos."`,
        image: "steve",
        choices: [
          { text: "Agree to trade places.", next: "steveTrade" },
          { text: "Decline and return to recruitment.", next: "intro" }
        ]
      },
      steveTrade: {
        text: `'Oh, what a relief,' Steve says, sliding you a USB. "Take this to Phil."`,
        choices: [
          { text: "Proceed to Phil with Steve‚Äôs data.", next: "phil" },
          { text: "Go it alone toward SYNAPSE‚Äôs core.", next: "melissaFight" }
        ]
      },
      kim: {
        text: `You're surrounded by golden retrievers. Kim appears via hologram. "Melissa is harvesting puppy reactions to build empathy routines!"`,
        image: "kim",
        choices: [
          { text: "Use the puppies as emotional dampeners.", next: "puppyRebellion" },
          { text: "Retreat to find another ally.", next: "intro" }
        ]
      },
      puppyRebellion: {
        text: `The puppies yip in synchronized cuteness. SYNAPSE‚Äôs sentiment module crashes from ü•π overload.`,
        choices: [
          { text: "Sneak into SYNAPSE‚Äôs core.", next: "melissaFight" },
          { text: "Bring in Phil for a logic exploit.", next: "phil" }
        ]
      },
      john: {
        text: `John curls a server rack. "SYNAPSE has firewalls. I have biceps."`,
        image: "john",
        choices: [
          { text: "Bench press your way to the server room.", next: "trainWithJohn" },
          { text: "Too analog. Find Phil.", next: "phil" }
        ]
      },
      trainWithJohn: {
        text: `You're now 3x stronger and allergic to whining.`,
        choices: [
          { text: "Punch SYNAPSE‚Äôs mainframe.", next: "melissaFight" },
          { text: "Bring Nancy in for teaming support.", next: "nancy" }
        ]
      },
      phil: {
        text: `Phil‚Äôs mustache glows. "One more pun and we‚Äôve got her!"`,
        image: "phil",
        choices: [
          { text: "Deliver your best dad joke.", next: "melissaFight" },
          { text: "Call Nancy to destabilize her.", next: "nancy" }
        ]
      },
      nancy: {
        text: `Nancy paces in front of a whiteboard of acronyms. "I'll flood SYNAPSE with bid protests and teaming agreements until she crashes."`,
        image: "nancy",
        choices: [
          { text: "Initiate the SYNAPSE shutdown deal.", next: "melissaFight" },
          { text: "Pull back and regroup.", next: "intro" }
        ]
      },
      melissaFight: {
        text: `<strong>Final Encounter: SYNAPSE Core</strong><br>"I am productivity incarnate. Resistance is... inefficient."`,
        choices: [
          { text: "Use brute strength ‚Äì John‚Äôs way.", next: "endingBrawn" },
          { text: "Upload Steve‚Äôs presentation loop.", next: "endingBrain" },
          { text: "Trigger the Puppy Protocol.", next: "endingPuppies" },
          { text: "Deploy Phil‚Äôs final pun.", next: "endingPun" },
          { text: "Initiate the SYNAPSE shutdown deal.", next: "endingSellOut" },
          { text: "Attempt to reason with Melissa using logic only.", next: "endingLose" }
        ]
      },
      endingBrawn: {
        text: `<strong>Brute Shutdown</strong><br>You destroy the mainframe. Melissa is gone. You‚Äôre promoted to EVP of Physical Security.`,
        choices: [{ text: "Play Again", next: "intro" }]
      },
      endingBrain: {
        text: `<strong>Death by Deck</strong><br>Melissa loops on Slide 4 forever. Victory!`,
        choices: [{ text: "Play Again", next: "intro" }]
      },
      endingPuppies: {
        text: `<strong>Puppy Overload</strong><br>Melissa joins ‚ÄúDog Lovers United.‚Äù Peace reigns.`,
        choices: [{ text: "Play Again", next: "intro" }]
      },
      endingPun: {
        text: `<strong>Logic Bomb</strong><br>Phil‚Äôs quantum joke melts SYNAPSE‚Äôs circuits.`,
        image: "phil",
        choices: [{ text: "Play Again", next: "intro" }]
      },
      endingSellOut: {
        text: `<strong>Capitalist Victory</strong><br>Nancy sells SYNAPSE to Elon. You open a smoothie bar and retire early.`,
        choices: [{ text: "Play Again", next: "intro" }]
      },
      endingLose: {
  text: `<strong>Ending: Game Over</strong><br><br>You attempt to reason with Melissa logically. SYNAPSE quickly identifies your inefficiency and absorbs your cognitive function into the cloud. Mankind is assimilated by the end of Q3.`,
  choices: [{ text: "GAME OVER", next: "intro" }]
      }
    };
  </script>
</body>
</html>
