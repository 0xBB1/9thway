<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>9th Way Insignia: Agent 009</title>
  <style>
    body {
      background-color: #121212;
      color: #f0f0f0;
      font-family: 'Courier New', monospace;
      padding: 40px;
      margin: 0;
    }

    #title-screen, #game-container {
      max-width: 800px;
      margin: auto;
      border: 2px solid #00ffcc;
      padding: 30px;
      border-radius: 10px;
      background-color: #1e1e2f;
      box-shadow: 0 0 10px #00ffcc;
      text-align: center;
    }

    h1 {
      font-size: 2em;
      margin-bottom: 10px;
    }

    .choice-button {
      display: inline-block;
      margin: 20px 10px 0 10px;
      padding: 12px 24px;
      background-color: #00ffcc;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      color: #000;
      font-weight: bold;
      font-size: 1em;
    }

    .choice-button:hover {
      background-color: #00e6b8;
    }

    #game-container {
      display: none;
      text-align: left;
    }

    .scene-image {
      max-width: 300px;
      display: block;
      margin: 20px auto;
      border: 2px solid #00ffcc;
      border-radius: 8px;
    }

    #mute-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #00ffcc;
      color: #000;
      border: none;
      padding: 10px 16px;
      font-weight: bold;
      border-radius: 5px;
      cursor: pointer;
      z-index: 999;
    }
  </style>
</head>
<body>

  <audio id="bg-music" src="game_assets/Enigma.mp3" loop autoplay muted></audio>
  <button id="mute-btn" onclick="toggleMute()">ðŸ”‡ Unmute</button>

  <div id="title-screen">
    <h1>9th Way Insignia: Agent 009</h1>
    <p><em>Stop the rise of SYNAPSE. Save humanity. Or at least, your job.</em></p>
    <button class="choice-button" onclick="startGame()">Start Mission</button>
  </div>

  <img id="character-image" src="" alt="" class="scene-image" style="display: none;" />

  <div id="game-container">
    <div id="story-text"></div>
    <div id="choices"></div>
  </div>

  <script>
    const recruited = new Set();
    const music = document.getElementById("bg-music");
    const muteBtn = document.getElementById("mute-btn");

    document.addEventListener("click", () => {
      if (music.paused) {
        music.muted = false;
        music.play().catch(e => console.error("Playback failed:", e));
        muteBtn.innerText = "ðŸ”Š Mute";
      }
    });

    function toggleMute() {
      music.muted = !music.muted;
      muteBtn.innerText = music.muted ? "ðŸ”‡ Unmute" : "ðŸ”Š Mute";
    }

    function startGame() {
      document.getElementById("title-screen").style.display = "none";
      document.getElementById("game-container").style.display = "block";
      renderScene("intro");
      recruited.clear();
    }

    function renderScene(key) {
      const scene = scenes[key];
      document.getElementById("story-text").innerHTML = scene.text;

      const choicesDiv = document.getElementById("choices");
      choicesDiv.innerHTML = "";

      const img = document.getElementById("character-image");
      const knownCharacters = ["steve", "kim", "john", "phil", "nancy", "melissaFight", "endingPun"];

      if (knownCharacters.includes(key)) {
        let imageName = key === "melissaFight" ? "melissa" : key;
        img.src = `game_assets/${imageName}.png`;
        img.style.display = "block";
        img.alt = `${imageName}`;
      } else {
        img.style.display = "none";
      }

      let choicesToShow = scene.choices;

      if (key === "intro") {
        const nancy = scene.choices.find(c => c.text.includes("Nancy"));
        choicesToShow = scene.choices.filter(c => c !== nancy);
        choicesToShow.push(nancy);
      }

      if (key === "melissaFight") {
        choicesToShow = scene.choices.filter(choice => {
          if (choice.text.includes("John") && recruited.has("john")) return true;
          if (choice.text.includes("Steve") && recruited.has("steve")) return true;
          if (choice.text.includes("Puppy") && recruited.has("kim")) return true;
          if (choice.text.includes("Phil") && recruited.has("phil")) return true;
          if (choice.text.includes("shutdown deal") && recruited.has("nancy")) return true;
          if (choice.text.includes("logic only")) return true;
          return false;
        });
      }

      choicesToShow.forEach(choice => {
        const button = document.createElement("button");
        button.className = "choice-button";
        button.textContent = choice.text;
        button.onclick = () =>
          typeof choice.next === "function"
            ? renderScene(choice.next())
            : renderScene(choice.next);
        choicesDiv.appendChild(button);
      });
    }

    const scenes = {
      // ... SCENE DATA CONTINUES HERE WITH EXPANDED BRANCHES & BAD ENDINGS
    };
  </script>
</body>
</html>
