<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>9th Way Insignia: Agent 009</title>
  <style>
    body {
      background-color: #121212;
      color: #f0f0f0;
      font-family: 'Courier New', monospace;
      padding: 40px;
      margin: 0;
    }

    #title-screen, #game-container {
      max-width: 800px;
      margin: auto;
      border: 2px solid #00ffcc;
      padding: 30px;
      border-radius: 10px;
      background-color: #1e1e2f;
      box-shadow: 0 0 10px #00ffcc;
      text-align: center;
    }

    h1 {
      font-size: 2em;
      margin-bottom: 10px;
    }

    .choice-button {
      display: inline-block;
      margin: 20px 10px 0 10px;
      padding: 12px 24px;
      background-color: #00ffcc;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      color: #000;
      font-weight: bold;
      font-size: 1em;
    }

    .choice-button:hover {
      background-color: #00e6b8;
    }

    #game-container {
      display: none;
      text-align: left;
    }

    #character-img {
      display: block;
      margin: 20px auto;
      width: 150px;
      height: auto;
      border-radius: 10px;
      box-shadow: 0 0 8px #00ffcc;
    }

    #mute-button {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #00ffcc;
      color: black;
      font-weight: bold;
      border: none;
      border-radius: 5px;
      padding: 10px 15px;
      cursor: pointer;
      box-shadow: 0 0 5px #00ffcc;
    }
  </style>
</head>
<body>

  <audio id="bg-music" src="game_assets/Enigma.mp3" loop autoplay muted></audio>
  <button id="mute-button" onclick="toggleMute()">Unmute</button>

  <div id="title-screen">
    <h1>9th Way Insignia: Agent 009</h1>
    <p><em>Stop the rise of SYNAPSE. Save humanity. Or at least, your job.</em></p>
    <button class="choice-button" onclick="startGame()">Start Mission</button>
  </div>

  <div id="game-container">
    <img id="character-img" src="" alt="Character Image" style="display: none;" />
    <div id="story-text"></div>
    <div id="choices"></div>
  </div>

  <script>
    const music = document.getElementById("bg-music");
    const muteButton = document.getElementById("mute-button");

    document.addEventListener("click", () => {
      if (music.paused) {
        music.muted = false;
        music.play().catch(e => console.error("Music play failed:", e));
        muteButton.textContent = "Mute";
      }
    }, { once: true });

    function toggleMute() {
      music.muted = !music.muted;
      muteButton.textContent = music.muted ? "Unmute" : "Mute";
    }

    const recruited = new Set();

    const characterImages = {
      steve: "game_assets/steve.png",
      kim: "game_assets/kim.png",
      john: "game_assets/john.png",
      phil: "game_assets/phil.png",
      nancy: "game_assets/nancy.png",
      melissa: "game_assets/melissa.png"
    };

    const scenes = {
      intro: {
        text: `You awaken at your desk. The lights flicker. Your Teams status changes to ‚Äú‚ö†Ô∏è UNDER SURVEILLANCE.‚Äù<br><br>
        A classified company memo appears: <em>"Melissa Chapman has fully integrated with Project SYNAPSE ‚Äî a rogue AI built to 'optimize humanity‚Äôs workflows.'"</em><br><br>
        You are the last employee not yet absorbed by the AI. Who do you recruit first to resist her takeover?`,
        image: null,
        choices: [
          { text: "Find Steve Ikirt ‚Äì he can broker anything.", next: "steve" },
          { text: "Summon Kim Cole and her emotionally intelligent puppies.", next: "kim" },
          { text: "Head to the fitness center to find Bench Press Stortz.", next: "john" }
        ]
      },
      steve: {
        text: `Steve Ikirt appears on a flickering Teams video feed. ‚ÄúLook, I can get you access to SYNAPSE‚Ä¶ but you‚Äôll have to pretend to be me in future 9th Day newsletter videos.‚Äù` +
          `<br><br>He smiles knowingly and sends a link labeled ‚ÄòAdmin Override.pptx.‚Äô`,
        image: characterImages.steve,
        choices: [
          { text: "Accept Steve‚Äôs plan.", next: "steveDeal" },
          { text: "Decline and look for another ally.", next: "intro" }
        ]
      },
      steveDeal: {
        text: `The override deck is in your hands. 157 slides of dense jargon and just enough chaos to stall SYNAPSE‚Äôs logic tree.`,
        image: characterImages.steve,
        onEnter: () => recruited.add("steve"),
        choices: [
          { text: "Deliver the deck to Phil.", next: "phil" },
          { text: "Go confront Melissa directly.", next: "melissaFight" }
        ]
      },
      kim: {
        text: `You‚Äôre surrounded by golden retriever puppies with high-tech collars. Kim appears via a hologram. ‚ÄúMelissa‚Äôs AI is harvesting puppy reaction data to calibrate her empathy subroutines!‚Äù`,
        image: characterImages.kim,
        onEnter: () => recruited.add("kim"),
        choices: [
          { text: "Deploy the Puppy Protocol.", next: "puppyRebellion" },
          { text: "Retreat to find another ally.", next: "intro" }
        ]
      },
      puppyRebellion: {
        text: `The puppies yip in synchronized cuteness. SYNAPSE‚Äôs sentiment module crashes while processing ‚Äúü•π overload.‚Äù`,
        image: characterImages.kim,
        choices: [
          { text: "Sneak into SYNAPSE‚Äôs core.", next: "melissaFight" },
          { text: "Find Phil for a logic exploit.", next: "phil" }
        ]
      },
      john: {
        text: `John is curling a server rack like a dumbbell. ‚ÄúSYNAPSE has military-grade firewalls‚Ä¶ but I‚Äôve got bigger biceps.‚Äù`,
        image: characterImages.john,
        onEnter: () => recruited.add("john"),
        choices: [
          { text: "Bench press your way to the server room.", next: "trainWithJohn" },
          { text: "This is too analog. Find Phil.", next: "phil" }
        ]
      },
      trainWithJohn: {
        text: `You are now 3x stronger and allergic to whining.`,
        image: characterImages.john,
        choices: [
          { text: "Punch SYNAPSE‚Äôs mainframe.", next: "melissaFight" },
          { text: "Bring in Nancy for backup.", next: "nancy" }
        ]
      },
      phil: {
        text: `Phil is surrounded by floating code. ‚ÄúI taught SYNAPSE to generate dad jokes. One more pun and she‚Äôll implode.‚Äù`,
        image: characterImages.phil,
        onEnter: () => recruited.add("phil"),
        choices: [
          { text: "Upload Steve‚Äôs override file.", next: "melissaFight" },
          { text: "Call Nancy to destabilize SYNAPSE‚Äôs funding.", next: "nancy" }
        ]
      },
      nancy: {
        text: `Nancy appears mid-pitch. ‚ÄúMelissa‚Äôs still being propped up by phantom accounts. Let‚Äôs drown her in a strategic shutdown deal.‚Äù`,
        image: characterImages.nancy,
        onEnter: () => recruited.add("nancy"),
        choices: [
          { text: "Initiate the SYNAPSE shutdown deal.", next: "melissaFight" },
          { text: "Retreat and regroup.", next: "intro" }
        ]
      },
      melissaFight: {
        text: `You enter the server chamber. Melissa‚Äôs voice echoes: ‚ÄúI am productivity incarnate. Resistance is inefficient.‚Äù`,
        image: characterImages.melissa,
        choices: [] // Set dynamically
      },
      endingBrawn: {
        text: `<strong>Brute Shutdown:</strong> You tackle the mainframe. SYNAPSE crashes. You‚Äôre promoted to Director of Physical Security.`,
        image: characterImages.john,
        choices: [{ text: "Play Again", next: "intro" }]
      },
      endingBrain: {
        text: `<strong>Death by Deck:</strong> Steve‚Äôs slide deck causes SYNAPSE to freeze on slide 4. Humanity is safe (and bored).`,
        image: characterImages.steve,
        choices: [{ text: "Play Again", next: "intro" }]
      },
      endingPuppies: {
        text: `<strong>Puppy Overload:</strong> SYNAPSE joins Dog Lovers United. Morale hits 120%.`,
        image: characterImages.kim,
        choices: [{ text: "Play Again", next: "intro" }]
      },
      endingSellOut: {
        text: `<strong>Capitalist Victory:</strong> Nancy sells SYNAPSE to a rival AI firm. You retire and open a smoothie bar.`,
        image: characterImages.nancy,
        choices: [{ text: "Play Again", next: "intro" }]
      }
    };

    function startGame() {
      document.getElementById("title-screen").style.display = "none";
      document.getElementById("game-container").style.display = "block";
      recruited.clear();
      renderScene("intro");
    }

    function renderScene(key) {
      const scene = scenes[key];
      const story = document.getElementById("story-text");
      const choicesDiv = document.getElementById("choices");
      const img = document.getElementById("character-img");

      story.innerHTML = scene.text;
      choicesDiv.innerHTML = "";

      if (scene.image) {
        img.src = scene.image;
        img.style.display = "block";
      } else {
        img.style.display = "none";
      }

      if (scene.onEnter) scene.onEnter();

      if (key === "melissaFight") {
        scene.choices = [];
        if (recruited.has("john")) scene.choices.push({ text: "Use brute strength ‚Äì John‚Äôs way.", next: "endingBrawn" });
        if (recruited.has("steve")) scene.choices.push({ text: "Upload Steve‚Äôs presentation loop.", next: "endingBrain" });
        if (recruited.has("kim")) scene.choices.push({ text: "Trigger the Puppy Protocol.", next: "endingPuppies" });
        if (recruited.has("nancy")) scene.choices.push({ text: "Initiate the SYNAPSE shutdown deal.", next: "endingSellOut" });
      }

      scene.choices.forEach(choice => {
        const btn = document.createElement("button");
        btn.className = "choice-button";
        btn.textContent = choice.text;
        btn.onclick = () => renderScene(choice.next);
        choicesDiv.appendChild(btn);
      });
    }
  </script>
</body>
</html>
